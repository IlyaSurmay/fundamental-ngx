<fd-toolbar [hasTitle]="true">
    <h4>{{ title }}</h4>
</fd-toolbar>

<div class="approval-flow-watchers">
    <p>Watchers</p>
    <fd-avatar style="margin-right: 10px; cursor: pointer;"
               tabindex="0"
               *ngFor="let watcher of _approvalProcess?.watchers"
               size="xs"
               [image]="watcher.imgUrl"
               [label]="watcher.name"
               [circle]="true"
               (keyup.enter)="$event.stopPropagation(); onWatcherClick(watcher)"
               (click)="onWatcherClick(watcher)"></fd-avatar>
</div>

<div class="approval-flow-container">
    <div class="approval-flow-carousel-controls" *ngIf="_isCarousel">
        <button class="approval-flow-controls-prev-slide" (click)="previousSlide()" *ngIf="_carouselStep > 0"> <fd-icon [glyph]="'navigation-left-arrow'"></fd-icon> {{ _carouselStep }}</button>
        <button class="approval-flow-controls-next-slide" (click)="nextSlide()" *ngIf="(_maxCarouselStep - _carouselStep) > 0">{{ _maxCarouselStep - _carouselStep }} <fd-icon [glyph]="'navigation-right-arrow'"></fd-icon></button>
    </div>
    <div class="approval-flow-graph-container">
        <div class="approval-flow-graph" #graphEl [style.left.px]="_carouselScrollX">
            <div class="approval-flow-column"
                 *ngFor="let column of _graph; let columnIndex = index; let firstColumn = first; let lastColumn = last"
                 [class.vertical-line-before]="column.nodes.length > 1 && !column.isPartial"
                 [class.vertical-line-after]="column.isPartial || (column.nodes.length > 1 && _graph[columnIndex + 1]?.nodes.length === 1)"
                 [class.vertical-line-after--solid]="column.allNodesApproved"
            >
                <ng-container *ngFor="let node of column.nodes; let nodeIndex = index; let firstNode = first; let lastNode = last">
                    <fdp-approval-flow-node
                        [attr.id]="'approval-graph-node-' + node.id"
                        [attr.tabindex]="node.blank ? -1 : 0"
                        [debug]="false"
                        [node]="node"
                        [blank]="node.blank"
                        [renderArrow]="columnIndex > 0"
                        [renderLineBefore]="(_isCarousel && firstColumn && firstNode) || !!node.parent && !_graph[columnIndex - 1]?.nodes[nodeIndex]?.blank"
                        [renderLineAfter]="(_isCarousel && lastColumn && lastNode) || !lastColumn && !node.blank && !_graph[columnIndex + 1]?.nodes[nodeIndex]?.blank"
                        [renderCarouselStartMarker]="(_isCarousel && firstColumn && firstNode)"
                        [renderCarouselEndMarker]="(_isCarousel && lastColumn && lastNode)"
                        (onNodeClick)="onNodeClick(node)"
                        (keyup.enter)="onNodeClick(node)"
                        (keydown)="onNodeKeyDown($event, node, column, nodeIndex, columnIndex)"
                    ></fdp-approval-flow-node>
                </ng-container>
            </div>
        </div>
    </div>
</div>
